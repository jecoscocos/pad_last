{% extends "base.html" %}
{% block title %}–ü–ª–∞—Ç–µ–∂–∏ - –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏{% endblock %}
{% block content %}
<div class="card">
	<h2 style="margin-bottom: 2rem;">üí≥ {% if current_user.role == 'agent' %}–í—Å–µ –ø–ª–∞—Ç–µ–∂–∏{% else %}–ú–æ–∏ –ø–ª–∞—Ç–µ–∂–∏{% endif %}</h2>

	{% if current_user.role != 'agent' %}
	<div style="margin-bottom: 2rem;">
		<button onclick="togglePaymentForm()" class="btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂</button>
	</div>

	<div id="payment-form" style="display: none; background: rgba(255, 255, 255, 0.6); padding: 2rem; border-radius: 12px; margin-bottom: 2rem; border: 2px solid var(--border);">
		<h3 style="margin-bottom: 1.5rem;">–ù–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂</h3>
		<form method="POST" action="{{ url_for('create_payment') }}" class="stack">
			<label>
				<span>–°—É–º–º–∞ (EUR):</span>
				<input type="number" name="amount" step="0.01" required placeholder="100.00">
			</label>
			<label>
				<span>ID –æ–±—ä–µ–∫—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</span>
				<input type="number" name="property_id" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5">
			</label>
			<button type="submit" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üí∞ –û–ø–ª–∞—Ç–∏—Ç—å</button>
		</form>
	</div>
	{% endif %}

	<h3 style="margin-bottom: 1.5rem;">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
	{% if transactions %}
		<div style="overflow-x: auto;">
			<table class="report-table">
				<thead>
					<tr>
						<th>ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</th>
						{% if current_user.role == 'agent' %}
						<th>User ID</th>
						{% endif %}
						<th>–°—É–º–º–∞</th>
						<th>–í–∞–ª—é—Ç–∞</th>
						<th>–°—Ç–∞—Ç—É—Å</th>
						<th>ID –æ–±—ä–µ–∫—Ç–∞</th>
						<th>–î–∞—Ç–∞</th>
					</tr>
				</thead>
				<tbody>
					{% for txn in transactions %}
					<tr>
						<td><code style="background: var(--secondary); padding: 0.25rem 0.5rem; border-radius: 6px; color: var(--primary); font-weight: 600;">{{ txn.transaction_id or txn.get('id', 'N/A') }}</code></td>
						{% if current_user.role == 'agent' %}
						<td><span style="background: #e8f4f8; padding: 0.25rem 0.75rem; border-radius: 6px; color: #0066cc; font-weight: 600;">{{ txn.user_id }}</span></td>
						{% endif %}
						<td><strong style="color: var(--accent); font-size: 1.1rem;">{{ "%.2f"|format(txn.amount) }} ‚Ç¨</strong></td>
						<td>{{ txn.currency or 'EUR' }}</td>
						<td>
							{% if txn.status == 'success' %}
								<span class="badge" style="background: #10b981;">‚úÖ –£—Å–ø–µ—à–Ω–æ</span>
							{% elif txn.status == 'pending' %}
								<span class="badge" style="background: #f59e0b;">‚è≥ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</span>
							{% else %}
								<span class="badge" style="background: #ef4444;">‚ùå –û—à–∏–±–∫–∞</span>
							{% endif %}
						</td>
						<td>{{ txn.property_id if txn.property_id else '‚Äî' }}</td>
						<td>{{ txn.created_at }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	{% else %}
		<div style="text-align: center; padding: 3rem; color: var(--text-muted); background: var(--secondary); border-radius: 12px;">
			<span style="font-size: 3rem;">üí≥</span>
			<p style="margin-top: 1rem; font-size: 1.1rem;">{% if current_user.role == 'agent' %}–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç{% else %}–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π{% endif %}</p>
			{% if current_user.role != 'agent' %}
			<p style="font-size: 0.9rem;">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</p>
			{% endif %}
		</div>
	{% endif %}
</div>

<script>
function togglePaymentForm() {
	const form = document.getElementById('payment-form');
	if (form.style.display === 'none') {
		form.style.display = 'block';
		form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
	} else {
		form.style.display = 'none';
	}
}
</script>
{% endblock %}
