{% extends 'base.html' %}
{% block title %}{{ p.title }}{% endblock %}
{% block content %}
<div class="card">
	<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start;">
		<div>
			<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 1rem;">
				<h2 style="color: var(--text); margin:0;">{{ p.title }}</h2>
				<span style="background:#e8f4f8; color:#0066cc; padding:0.4rem 1rem; border-radius:8px; font-size:0.95rem; font-weight:600;">
					ID: {{ p.id }}
				</span>
			</div>
			<div class="property-location" style="margin-bottom: 1rem;">
				üìç {{ p.city }}, {{ p.address }}
			</div>
			<div class="property-price" style="font-size: 2rem; margin-bottom: 1.5rem;">
				{{ '%.0f' % p.price_eur }} ‚Ç¨
			</div>
			
			<div class="property-details" style="margin-bottom: 1.5rem;">
				<span class="property-detail">{{ p.property_type }}</span>
				{% if p.area_m2 %}
				<span class="property-detail">üìê {{ '%.1f' % p.area_m2 }} –º¬≤</span>
				{% endif %}
				{% if p.rooms %}
				<span class="property-detail">üõèÔ∏è {{ p.rooms }} –∫–æ–º–Ω.</span>
				{% endif %}
			</div>
			
			<div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
				{% if p.is_for_sale %}
				<span style="background: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">–ü—Ä–æ–¥–∞–∂–∞</span>
				{% endif %}
				{% if p.is_for_rent %}
				<span style="background: var(--primary); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">–ê—Ä–µ–Ω–¥–∞</span>
				{% endif %}
			</div>
			
			{% if p.description %}
			<div style="background: var(--secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
				<h3 style="margin-bottom: 1rem;">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
				<p style="line-height: 1.6;">{{ p.description }}</p>
			</div>
			{% endif %}
			
			{% if current_user.is_authenticated and current_user.role == 'agent' %}
			<form action="{{ url_for('property_delete', property_id=p.id) }}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç?')" style="margin-top: 2rem;">
				<button type="submit" style="background: #ef4444; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç</button>
			</form>
			<a href="{{ url_for('edit_property', property_id=p.id) }}" class="button" style="margin-top: 1rem;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
			{% endif %}
		</div>
		
		<div>
			{% if p.photos %}
			<div class="photos">
				<h3 style="margin-bottom: 1rem;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
					{% for photo in p.photos %}
					<img src="{{ url_for('uploaded_file', filename=photo.file_path) }}" alt="–§–æ—Ç–æ –æ–±—ä–µ–∫—Ç–∞" style="width: 100%; height: 150px; object-fit: contain; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
					{% endfor %}
				</div>
			</div>
			{% else %}
			<div style="background: var(--secondary); padding: 3rem; border-radius: 12px; text-align: center; color: var(--text-muted);">
				<span style="font-size: 3rem;">üè†</span>
				<p style="margin-top: 1rem;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>
			</div>
			{% endif %}
		</div>
	</div>
</div>

{% if not current_user.is_authenticated or current_user.role == 'user' %}
<section class="card">
   <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</h3>
   <p style="color: var(--text-muted); margin-bottom: 1.5rem;">–ó–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω—ã –≤ —ç—Ç–æ–º –æ–±—ä–µ–∫—Ç–µ? –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏!</p>
   <form action="{{ url_for('create_inquiry', property_id=p.id) }}" method="post" class="stack">
	   <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
		   <label>
			   <span>–í–∞—à–µ –∏–º—è *</span>
			   <input name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
		   </label>
		   <label>
			   <span>–¢–µ–ª–µ—Ñ–æ–Ω</span>
			   <input type="tel" name="phone" placeholder="+373 XX XXX XXX">
		   </label>
	   </div>
	   <label>
		   <span>Email</span>
		   <input type="email" name="email" placeholder="your@email.com" 
		          value="{{ current_user.email if current_user.is_authenticated else '' }}"
		          {% if current_user.is_authenticated %}readonly style="background:#f0f0f0"{% endif %}>
	   </label>
	   <label>
		   <span>–°–æ–æ–±—â–µ–Ω–∏–µ</span>
		   <textarea name="message" rows="4" placeholder="–í–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ –ø–æ–≤–æ–¥—É —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞"></textarea>
	   </label>
	   <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
   </form>
</section>
{% endif %}
{% endblock %}